<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EcoHaven</title>
  
  <!-- ApexCharts Library -->
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <!-- MQTT.js Library -->
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
  <!-- Firebase (versi compat untuk kemudahan integrasi) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  
  <style>
    /* --- Tema Kayu Cerah & Layout Dasar --- */
    body { 
      font-family: 'Arial', sans-serif; 
      background: url('https://www.publicdomainpictures.net/pictures/40000/velka/wood-texture-background.jpg') no-repeat center center fixed;
      background-size: cover;
      padding: 20px;
      text-align: center;
      color: #4E342E;
    }
    h1, h2 {
      color: #3E2723;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }
    .section {
      margin-bottom: 40px;
    }
    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }
    .card {
      background: rgba(255, 245, 235, 0.9);
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
      border: 2px solid #6D4C41;
    }
    .card h3 {
      margin-bottom: 10px;
      color: #5D4037;
    }
    /* --- Bagian Tombol Light 1-4 --- */
    .light-container {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
      margin-bottom: 40px;
    }
    .light-card {
      width: 70px;
      height: 70px;
      border-radius: 15px;
      background: #5D4037;       /* Warna default OFF */
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #fff;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.4);
      transition: background 0.3s;
    }
    .light-card.on {
      background: #FF9800;       /* Warna jika ON */
    }
    .light-icon {
      width: 48px;
      height: 48px;
    }
    .light-label {
      margin-top: 8px;
      font-size: 12px;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>EcoHaven</h1>
  
  <!-- Flammable Gas Section -->
  <div class="section">
    <h2>üî• Flammable Gas</h2>
    <div class="dashboard">
      <div class="card">
        <h3>LPG</h3>
        <div id="gauge-lpg"></div>
      </div>
      <div class="card">
        <h3>Metana</h3>
        <div id="gauge-metana"></div>
      </div>
    </div>
  </div>
  
  <!-- Toxic Gas Section -->
  <div class="section">
    <h2>‚ò£Ô∏è Toxic Gas</h2>
    <div class="dashboard">
      <div class="card">
        <h3>CO</h3>
        <div id="gauge-CO"></div>
      </div>
      <div class="card">
        <h3>Amonia</h3>
        <div id="gauge-amonia"></div>
      </div>
      <div class="card">
        <h3>Alkohol</h3>
        <div id="gauge-alkohol"></div>
      </div>
      <div class="card">
        <h3>CO2</h3>
        <div id="gauge-co2"></div>
      </div>
    </div>
  </div>
  
  <!-- Temperature Section -->
  <div class="section">
    <h2>üå°Ô∏è Temperature</h2>
    <div class="dashboard">
      <div class="card">
        <h3>Suhu (¬∞C)</h3>
        <div id="gauge-suhu"></div>
      </div>
    </div>
  </div>
  
  <!-- Light Control Section -->
  <div class="light-container">
    <div class="light-card" id="light1" onclick="toggleLight(1)">
      <svg class="light-icon" viewBox="0 0 64 64" fill="none" stroke="currentColor" stroke-width="8" stroke-linecap="round" stroke-linejoin="round">
        <line x1="32" y1="8" x2="32" y2="24"/>
        <path d="M44 20 A20 20 0 1 1 20 20"/>
      </svg>
      <div class="light-label">Light 1</div>
    </div>
    <div class="light-card" id="light2" onclick="toggleLight(2)">
      <svg class="light-icon" viewBox="0 0 64 64" fill="none" stroke="currentColor" stroke-width="8" stroke-linecap="round" stroke-linejoin="round">
        <line x1="32" y1="8" x2="32" y2="24"/>
        <path d="M44 20 A20 20 0 1 1 20 20"/>
      </svg>
      <div class="light-label">Light 2</div>
    </div>
    <div class="light-card" id="light3" onclick="toggleLight(3)">
      <svg class="light-icon" viewBox="0 0 64 64" fill="none" stroke="currentColor" stroke-width="8" stroke-linecap="round" stroke-linejoin="round">
        <line x1="32" y1="8" x2="32" y2="24"/>
        <path d="M44 20 A20 20 0 1 1 20 20"/>
      </svg>
      <div class="light-label">Light 3</div>
    </div>
    <div class="light-card" id="light4" onclick="toggleLight(4)">
      <svg class="light-icon" viewBox="0 0 64 64" fill="none" stroke="currentColor" stroke-width="8" stroke-linecap="round" stroke-linejoin="round">
        <line x1="32" y1="8" x2="32" y2="24"/>
        <path d="M44 20 A20 20 0 1 1 20 20"/>
      </svg>
      <div class="light-label">Light 4</div>
    </div>
  </div>
  
  <!-- Grafik Threshold Chart (data sensor melebihi threshold) -->
  <div class="section">
    <h2>Grafik Data Sensor (Melebihi Batas)</h2>
    <div id="thresholdChart"></div>
  </div>
  
  <!-- Grafik Alert Chart (data sensor berdasarkan batas sensor) -->
  <div class="section">
    <h2>Grafik Data Sensor Alert</h2>
    <div id="alertChart"></div>
  </div>
  
  <script>
    // Limit untuk sensor
    const limits = {
      lpg: 100,      // batas LPG
      metana: 50,    // batas Metana
      nox: 100,      // batas NOx
      amonia: 50,    // batas Amonia
      alkohol: 20,   // batas Alkohol
      co2: 1000,     // batas CO2
      suhu: 30       // batas Suhu (¬∞C)
    };

    let thresholdData = [];
    let alertData = [];

    const saveState = (key, value) => {
      localStorage.setItem(key, JSON.stringify(value));
    };

    const loadState = (key, callback) => {
      const data = localStorage.getItem(key);
      if (data) {
        callback(JSON.parse(data));
      } else {
        callback(null);
      }
    };

    const optionsThresholdChart = {
      chart: {
        type: 'line',
        height: 350,
        zoom: { enabled: false },
        toolbar: { show: false }
      },
      series: [{ name: 'Threshold Data', data: thresholdData }],
      xaxis: { type: 'datetime' },
      yaxis: { title: { text: 'Value' } },
      title: { text: 'Threshold Sensor Data', align: 'center' }
    };

    const optionsAlertChart = {
      chart: {
        type: 'bar',
        height: 350,
        zoom: { enabled: false },
        toolbar: { show: false }
      },
      series: [{ name: 'Alert Data', data: alertData }],
      xaxis: { type: 'datetime' },
      yaxis: { title: { text: 'Value' } },
      title: { text: 'Alert Sensor Data', align: 'center' }
    };

    const chartThreshold = new ApexCharts(document.querySelector("#thresholdChart"), optionsThresholdChart);
    const chartAlert = new ApexCharts(document.querySelector("#alertChart"), optionsAlertChart);
    
    chartThreshold.render();
    chartAlert.render();
  </script>
</body>
</html>
